"use strict";const ACTIVE_TASKS_STORAGE="activeTasks",DONE_TASKS_STORAGE="doneTasks",DONE_TASK_CLASS="js-done-task",addTaskForm=document.querySelector(".task-form"),taskInput=document.querySelector(".task-input"),taskInputLabel=document.querySelector(".task-label"),taskValidationMessage=document.querySelector(".task-validation"),filterInput=document.querySelector(".filter-tasks"),clearFilterBtn=document.querySelector(".clear-filter-btn"),taskList=document.querySelector(".task-list"),clearTasksBtn=document.querySelector(".clear-tasks-btn"),doneTaskList=document.querySelector(".archive-list"),doneTaskBtn=document.querySelector(".toggle-archive-btn"),clearDoneTasksBtn=document.querySelector(".clear-archive-btn"),doneTaskCount=document.querySelector(".js-archive-counter"),clearTaskInput=()=>{taskInput.value=""},clearFilterInput=()=>{filterInput.value=""},onTaskInputFocus=()=>{taskInputLabel.classList.add("task-input-focus"),setTimeout(()=>{taskInput.placeholder="feed the raccoon"},200),taskInput.addEventListener("blur",onTaskInputBlur)},onTaskInputBlur=()=>{taskInput.value.length||taskInputLabel.classList.remove("task-input-focus"),setTimeout(()=>{taskInput.placeholder=""},100),taskInput.removeEventListener("blur",onTaskInputBlur)},addTask=evt=>{evt.preventDefault(),taskInput.value.trim().length?(hideValidationText(),renderTask(taskInput.value),addTaskToLocalStorage(taskInput.value,"activeTasks"),clearTaskInput(),filterTasks()):showValidationText()},showValidationText=()=>{taskValidationMessage.style.display="block",taskValidationMessage.textContent="* text can't consist of spaces",setTimeout(()=>{hideValidationText()},3e3)},hideValidationText=()=>{taskValidationMessage.style.display="none"},renderTask=(taskValue,isDone=!1)=>{const taskTemplate=document.querySelector("#task-item").content.cloneNode(!0),taskCheckbox=taskTemplate.querySelector(".task-checkbox"),taskContent=taskTemplate.querySelector(".task-content"),delBtn=taskTemplate.querySelector(".delete-btn");taskContent.textContent=taskValue,taskCheckbox.addEventListener("input",taskCheckboxHandler),delBtn.addEventListener("click",onDeleteTaskBtnClick),isDone?(taskCheckbox.checked=!0,taskContent.classList.add("js-done-task"),doneTaskList.appendChild(taskTemplate)):taskList.appendChild(taskTemplate)},taskCheckboxHandler=evt=>{const taskContent=evt.target.parentElement.querySelector(".task-content");!0===evt.target.checked?(taskContent.classList.add("js-done-task"),doneTaskList.appendChild(evt.target.parentElement),addTaskToLocalStorage(taskContent.textContent,"doneTasks"),removeTaskFromLocalStorage(taskContent.textContent,"activeTasks")):(taskContent.classList.remove("js-done-task"),taskList.appendChild(evt.target.parentElement),addTaskToLocalStorage(taskContent.textContent,"activeTasks"),removeTaskFromLocalStorage(taskContent.textContent,"doneTasks")),setDoneTasksCounter()},onDeleteTaskBtnClick=evt=>{evt.preventDefault();const taskContent=evt.target.parentElement.querySelector(".task-content");evt.target.parentElement.remove(),taskContent.classList.contains("js-done-task")?(removeTaskFromLocalStorage(taskContent.textContent,"doneTasks"),setDoneTasksCounter()):removeTaskFromLocalStorage(taskContent.textContent,"activeTasks")},filterTasks=()=>{document.querySelectorAll(".task-list .task-item").forEach(task=>{const item=task.querySelector(".task-content").textContent;-1!==item.toLowerCase().indexOf(filterInput.value.toLowerCase())?task.style.display="flex":task.style.display="none"})},onClearTasksBtnClick=()=>{for(;taskList.firstChild;)taskList.removeChild(taskList.firstChild);clearFilterInput(),clearLocalStorage("activeTasks")},onClearFilterBtnClick=()=>{clearFilterInput(),filterTasks()},setDoneTasksCounter=()=>{const archiveTasksCount=doneTaskList.querySelectorAll(".task-item").length;doneTaskCount.textContent=archiveTasksCount,clearDoneTasksBtn.style.display=archiveTasksCount>1?"inline-block":"none"},onClearDoneTasksBtnClick=()=>{for(;doneTaskList.firstChild;)doneTaskList.removeChild(doneTaskList.firstChild);setDoneTasksCounter(),clearLocalStorage("doneTasks")},onDoneBtnClick=evt=>{evt.preventDefault(),"hide"===evt.target.textContent?(doneTaskList.style.display="none",evt.target.textContent="show"):"show"===evt.target.textContent&&(doneTaskList.style.display="block",evt.target.textContent="hide")},checkLocalStorage=storageName=>{let tasks;return tasks=null===localStorage.getItem(storageName)?[]:JSON.parse(localStorage.getItem(storageName))},addTaskToLocalStorage=(task,storageName)=>{let tasks=checkLocalStorage(storageName);tasks.push(task),localStorage.setItem(storageName,JSON.stringify(tasks))},removeTaskFromLocalStorage=(task,storageName)=>{let tasks=checkLocalStorage(storageName);for(let i=0;i<tasks.length;i++)if(task===tasks[i])return tasks.splice(i,1),void localStorage.setItem(storageName,JSON.stringify(tasks))},clearLocalStorage=(storageName=null)=>{null===storageName?localStorage.clear():localStorage.removeItem(storageName)},getTasksFromLocalStorage=()=>{const activeTasks=checkLocalStorage("activeTasks"),doneTasks=checkLocalStorage("doneTasks");activeTasks.forEach(task=>{renderTask(task)}),doneTasks.forEach(task=>{renderTask(task,!0)}),setDoneTasksCounter()};clearTaskInput(),clearFilterInput(),taskInput.placeholder="",document.addEventListener("DOMContentLoaded",getTasksFromLocalStorage),addTaskForm.addEventListener("submit",addTask),taskInput.addEventListener("focus",onTaskInputFocus),filterInput.addEventListener("input",filterTasks),clearFilterBtn.addEventListener("click",onClearFilterBtnClick),clearTasksBtn.addEventListener("click",onClearTasksBtnClick),clearDoneTasksBtn.addEventListener("click",onClearDoneTasksBtnClick),doneTaskBtn.addEventListener("click",onDoneBtnClick);